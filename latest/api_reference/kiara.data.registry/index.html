
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Kiara project">
      
      
      
        <meta name="author" content="Markus Binsteiner">
      
      
        <link rel="canonical" href="https://dharpa.org/kiara/latest/api_reference/kiara.data.registry/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>➜ data.registry - Kiara</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kiaradataregistry" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Kiara" class="md-header__button md-logo" aria-label="Kiara" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kiara
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ➜ data.registry
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/DHARPA-Project/kiara/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Kiara" class="md-nav__button md-logo" aria-label="Kiara" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Kiara
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/DHARPA-Project/kiara/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        Install
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Architecture" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/data/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/data/data_formats/" class="md-nav__link">
        Formats
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Workflows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Workflows" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Workflows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/workflows/" class="md-nav__link">
        Workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/workflows/modularity/modularity/" class="md-nav__link">
        Modularity
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/metadata/" class="md-nav__link">
        Metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/decisions/" class="md-nav__link">
        Decisions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/assumptions/" class="md-nav__link">
        Assumptions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          API reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara/" class="md-nav__link">
        kiara
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.config/" class="md-nav__link">
        ➜ config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.data/" class="md-nav__link">
        ➜ data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.data.onboarding/" class="md-nav__link">
        ➜ data.onboarding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.data.onboarding.batch/" class="md-nav__link">
        ➜ data.onboarding.batch
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          ➜ data.registry
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        ➜ data.registry
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__" class="md-nav__link">
    kiara.data.registry.__init__
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.BaseDataRegistry" class="md-nav__link">
    BaseDataRegistry
  </a>
  
    <nav class="md-nav" aria-label="BaseDataRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.BaseDataRegistry.find_all_values_of_type" class="md-nav__link">
    find_all_values_of_type()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.BaseDataRegistry.get_versions_for_alias" class="md-nav__link">
    get_versions_for_alias()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.DataRegistry" class="md-nav__link">
    DataRegistry
  </a>
  
    <nav class="md-nav" aria-label="DataRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.DataRegistry.register_alias" class="md-nav__link">
    register_alias()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.ValueSlotUpdateHandler" class="md-nav__link">
    ValueSlotUpdateHandler
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.data.registry.store/" class="md-nav__link">
        ➜ data.registry.store
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.data.types/" class="md-nav__link">
        ➜ data.types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.data.types.core/" class="md-nav__link">
        ➜ data.types.core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.data.types.type_mgmt/" class="md-nav__link">
        ➜ data.types.type_mgmt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.data.values/" class="md-nav__link">
        ➜ data.values
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.data.values.value_set/" class="md-nav__link">
        ➜ data.values.value_set
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.defaults/" class="md-nav__link">
        ➜ defaults
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.doc/" class="md-nav__link">
        ➜ doc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.doc.generate_api_doc/" class="md-nav__link">
        ➜ doc.generate_api_doc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.doc.mkdocs_macros_cli/" class="md-nav__link">
        ➜ doc.mkdocs_macros_cli
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.doc.mkdocs_macros_kiara/" class="md-nav__link">
        ➜ doc.mkdocs_macros_kiara
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.environment/" class="md-nav__link">
        ➜ environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.environment.operating_system/" class="md-nav__link">
        ➜ environment.operating_system
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.environment.python/" class="md-nav__link">
        ➜ environment.python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.events/" class="md-nav__link">
        ➜ events
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.examples/" class="md-nav__link">
        ➜ examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.examples.example_controller/" class="md-nav__link">
        ➜ examples.example_controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.exceptions/" class="md-nav__link">
        ➜ exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.info/" class="md-nav__link">
        ➜ info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.info.kiara/" class="md-nav__link">
        ➜ info.kiara
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.info.metadata/" class="md-nav__link">
        ➜ info.metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.info.modules/" class="md-nav__link">
        ➜ info.modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.info.operations/" class="md-nav__link">
        ➜ info.operations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.info.pipelines/" class="md-nav__link">
        ➜ info.pipelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.info.types/" class="md-nav__link">
        ➜ info.types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces/" class="md-nav__link">
        ➜ interfaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli/" class="md-nav__link">
        ➜ interfaces.cli
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.data/" class="md-nav__link">
        ➜ interfaces.cli.data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.data.commands/" class="md-nav__link">
        ➜ interfaces.cli.data.commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.dev/" class="md-nav__link">
        ➜ interfaces.cli.dev
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.dev.commands/" class="md-nav__link">
        ➜ interfaces.cli.dev.commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.environment/" class="md-nav__link">
        ➜ interfaces.cli.environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.environment.commands/" class="md-nav__link">
        ➜ interfaces.cli.environment.commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.explain/" class="md-nav__link">
        ➜ interfaces.cli.explain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.info/" class="md-nav__link">
        ➜ interfaces.cli.info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.info.commands/" class="md-nav__link">
        ➜ interfaces.cli.info.commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.metadata/" class="md-nav__link">
        ➜ interfaces.cli.metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.metadata.commands/" class="md-nav__link">
        ➜ interfaces.cli.metadata.commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.module/" class="md-nav__link">
        ➜ interfaces.cli.module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.module.commands/" class="md-nav__link">
        ➜ interfaces.cli.module.commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.operation/" class="md-nav__link">
        ➜ interfaces.cli.operation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.operation.commands/" class="md-nav__link">
        ➜ interfaces.cli.operation.commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.pipeline/" class="md-nav__link">
        ➜ interfaces.cli.pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.pipeline.commands/" class="md-nav__link">
        ➜ interfaces.cli.pipeline.commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.run/" class="md-nav__link">
        ➜ interfaces.cli.run
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.type/" class="md-nav__link">
        ➜ interfaces.cli.type
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.type.commands/" class="md-nav__link">
        ➜ interfaces.cli.type.commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.cli.utils/" class="md-nav__link">
        ➜ interfaces.cli.utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.python_api/" class="md-nav__link">
        ➜ interfaces.python_api
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.interfaces.python_api.controller/" class="md-nav__link">
        ➜ interfaces.python_api.controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.kiara/" class="md-nav__link">
        ➜ kiara
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.metadata/" class="md-nav__link">
        ➜ metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.metadata.core_models/" class="md-nav__link">
        ➜ metadata.core_models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.metadata.data/" class="md-nav__link">
        ➜ metadata.data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.metadata.mgmt/" class="md-nav__link">
        ➜ metadata.mgmt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.metadata.module_models/" class="md-nav__link">
        ➜ metadata.module_models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.metadata.operation_models/" class="md-nav__link">
        ➜ metadata.operation_models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.metadata.type_models/" class="md-nav__link">
        ➜ metadata.type_models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.module/" class="md-nav__link">
        ➜ module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.module_config/" class="md-nav__link">
        ➜ module_config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.module_mgmt/" class="md-nav__link">
        ➜ module_mgmt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.module_mgmt.merged/" class="md-nav__link">
        ➜ module_mgmt.merged
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.module_mgmt.pipelines/" class="md-nav__link">
        ➜ module_mgmt.pipelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.module_mgmt.python_classes/" class="md-nav__link">
        ➜ module_mgmt.python_classes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.modules/" class="md-nav__link">
        ➜ modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.modules.metadata/" class="md-nav__link">
        ➜ modules.metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.modules.pipelines/" class="md-nav__link">
        ➜ modules.pipelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.modules.save_value/" class="md-nav__link">
        ➜ modules.save_value
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.modules.type_conversion/" class="md-nav__link">
        ➜ modules.type_conversion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations/" class="md-nav__link">
        ➜ operations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations.calculate_hash/" class="md-nav__link">
        ➜ operations.calculate_hash
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations.create_value/" class="md-nav__link">
        ➜ operations.create_value
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations.data_export/" class="md-nav__link">
        ➜ operations.data_export
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations.data_import/" class="md-nav__link">
        ➜ operations.data_import
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations.extract_metadata/" class="md-nav__link">
        ➜ operations.extract_metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations.merge_values/" class="md-nav__link">
        ➜ operations.merge_values
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations.pretty_print/" class="md-nav__link">
        ➜ operations.pretty_print
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations.sample/" class="md-nav__link">
        ➜ operations.sample
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations.serialize/" class="md-nav__link">
        ➜ operations.serialize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.operations.store_value/" class="md-nav__link">
        ➜ operations.store_value
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.pipeline/" class="md-nav__link">
        ➜ pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.pipeline.config/" class="md-nav__link">
        ➜ pipeline.config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.pipeline.controller/" class="md-nav__link">
        ➜ pipeline.controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.pipeline.controller.batch/" class="md-nav__link">
        ➜ pipeline.controller.batch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.pipeline.listeners/" class="md-nav__link">
        ➜ pipeline.listeners
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.pipeline.module/" class="md-nav__link">
        ➜ pipeline.module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.pipeline.pipeline/" class="md-nav__link">
        ➜ pipeline.pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.pipeline.structure/" class="md-nav__link">
        ➜ pipeline.structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.pipeline.utils/" class="md-nav__link">
        ➜ pipeline.utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.pipeline.values/" class="md-nav__link">
        ➜ pipeline.values
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.processing/" class="md-nav__link">
        ➜ processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.processing.parallel/" class="md-nav__link">
        ➜ processing.parallel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.processing.processor/" class="md-nav__link">
        ➜ processing.processor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.processing.synchronous/" class="md-nav__link">
        ➜ processing.synchronous
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.rendering/" class="md-nav__link">
        ➜ rendering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.rendering.jinja/" class="md-nav__link">
        ➜ rendering.jinja
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.rendering.mgmt/" class="md-nav__link">
        ➜ rendering.mgmt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.sessions/" class="md-nav__link">
        ➜ sessions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.utils/" class="md-nav__link">
        ➜ utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.utils.class_loading/" class="md-nav__link">
        ➜ utils.class_loading
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.utils.concurrency/" class="md-nav__link">
        ➜ utils.concurrency
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.utils.doc/" class="md-nav__link">
        ➜ utils.doc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.utils.global_metadata/" class="md-nav__link">
        ➜ utils.global_metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.utils.jupyter/" class="md-nav__link">
        ➜ utils.jupyter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.utils.modules/" class="md-nav__link">
        ➜ utils.modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.utils.output/" class="md-nav__link">
        ➜ utils.output
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.workflow/" class="md-nav__link">
        ➜ workflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.workflow.kiara_workflow/" class="md-nav__link">
        ➜ workflow.kiara_workflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kiara.workflow.wrapped/" class="md-nav__link">
        ➜ workflow.wrapped
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__" class="md-nav__link">
    kiara.data.registry.__init__
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.BaseDataRegistry" class="md-nav__link">
    BaseDataRegistry
  </a>
  
    <nav class="md-nav" aria-label="BaseDataRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.BaseDataRegistry.find_all_values_of_type" class="md-nav__link">
    find_all_values_of_type()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.BaseDataRegistry.get_versions_for_alias" class="md-nav__link">
    get_versions_for_alias()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.DataRegistry" class="md-nav__link">
    DataRegistry
  </a>
  
    <nav class="md-nav" aria-label="DataRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.DataRegistry.register_alias" class="md-nav__link">
    register_alias()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kiara.data.registry.__init__.ValueSlotUpdateHandler" class="md-nav__link">
    ValueSlotUpdateHandler
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/DHARPA-Project/kiara/edit/master/src/kiara/data/registry/__init__.py" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="kiaradataregistry">kiara.data.registry<a class="headerlink" href="#kiaradataregistry" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-module">

<a id="kiara.data.registry.__init__"></a>
    <div class="doc doc-contents first">




  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h2 id="kiara.data.registry.__init__.BaseDataRegistry" class="doc doc-heading">
        <code>
BaseDataRegistry            (<span title="abc.ABC">ABC</span>)
        </code>



<a href="#kiara.data.registry.__init__.BaseDataRegistry" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Base class to extend if you want to write a <em>kiara</em> data registry.</p>
<p>This outlines the main methods that must be available for an entity that holds some values and their data, as
well as their associated aliases. In most cases users will interact with subclasses of the more fully
featured [DataRegistry][kiara.data.registry.DataRegistry] class, but there are cases where it will make sense
to sub-class this base class directly (like for example read-only 'archive' data registries).</p>

        <details class="quote">
          <summary>Source code in <code>kiara/data/registry/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">BaseDataRegistry</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class to extend if you want to write a *kiara* data registry.</span>

<span class="sd">    This outlines the main methods that must be available for an entity that holds some values and their data, as</span>
<span class="sd">    well as their associated aliases. In most cases users will interact with subclasses of the more fully</span>
<span class="sd">    featured [DataRegistry][kiara.data.registry.DataRegistry] class, but there are cases where it will make sense</span>
<span class="sd">    to sub-class this base class directly (like for example read-only &#39;archive&#39; data registries).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kiara</span><span class="p">:</span> <span class="s2">&quot;Kiara&quot;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kiara</span><span class="p">:</span> <span class="n">Kiara</span> <span class="o">=</span> <span class="n">kiara</span>
        <span class="c1"># self._hashes: typing.Dict[str, typing.Dict[str, str]] = {}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_register_tokens</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_available_value_ids</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">alias_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_available_aliases</span><span class="p">())</span>

    <span class="c1"># ======================================================================</span>
    <span class="c1"># main abstract methods</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_get_available_value_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return all of the registries available value ids.&quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_get_value_obj_for_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Value</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_get_value_data_for_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_get_available_aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">pass</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_get_value_slot_for_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueSlot</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_get_value_lineage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueLineage</span><span class="p">]:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_find_value_for_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hashes</span><span class="p">:</span> <span class="n">ValueHash</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Value</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a value that matches one of the provided hashes.</span>

<span class="sd">        This method does not need to be overwritten, but it is recommended that it is done for performance reasons.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            hashes: a collection of hashes,</span>
<span class="sd">        Returns:</span>
<span class="sd">            A (registered) value that matches one of the hashes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># -----------------------------------------------------------------------</span>
    <span class="c1"># main value retrieval methods</span>
    <span class="k">def</span> <span class="nf">_create_alias_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueAlias</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">alias</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;value:&quot;</span><span class="p">):</span>
            <span class="n">alias</span> <span class="o">=</span> <span class="n">alias</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span>
        <span class="n">value_alias</span> <span class="o">=</span> <span class="n">ValueAlias</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">value_alias</span><span class="o">=</span><span class="n">alias</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">value_alias</span><span class="o">.</span><span class="n">alias</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_available_value_ids</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">value_alias</span><span class="o">.</span><span class="n">alias</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_available_aliases</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Neither id nor alias &#39;</span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; registered with this registry.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">value_alias</span><span class="o">.</span><span class="n">alias</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_available_aliases</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">value_alias</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">value_alias</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">value_alias</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_version_for_alias</span><span class="p">(</span><span class="n">value_alias</span><span class="o">.</span><span class="n">alias</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value_alias</span>

    <span class="k">def</span> <span class="nf">get_value_obj</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_item</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">ValueAlias</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">],</span>
        <span class="n">raise_exception</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Value</span><span class="p">]:</span>

        <span class="k">if</span> <span class="n">value_item</span> <span class="o">==</span> <span class="n">NO_ID_YET_MARKER</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can&#39;t get value object: value not fully registered yet.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_item</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
            <span class="n">value_item</span> <span class="o">=</span> <span class="n">value_item</span><span class="o">.</span><span class="n">id</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_item</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">):</span>
            <span class="n">value_item</span> <span class="o">=</span> <span class="n">value_item</span><span class="o">.</span><span class="n">get_latest_value</span><span class="p">()</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">value_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_alias_obj</span><span class="p">(</span><span class="n">value_item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_item</span><span class="p">,</span> <span class="n">ValueAlias</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value_item</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; for value item parameter.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">value_item</span><span class="o">.</span><span class="n">alias</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_available_value_ids</span><span class="p">():</span>
            <span class="n">_value_id</span> <span class="o">=</span> <span class="n">value_item</span><span class="o">.</span><span class="n">alias</span>
            <span class="n">_value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Value</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value_obj_for_id</span><span class="p">(</span><span class="n">_value_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">value_item</span><span class="o">.</span><span class="n">alias</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_available_aliases</span><span class="p">():</span>
            <span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_alias_to_value</span><span class="p">(</span><span class="n">value_item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">raise_exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No value or alias registered in registry for: </span><span class="si">{</span><span class="n">value_item</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">_value</span>

    <span class="k">def</span> <span class="nf">get_value_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value_item</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">,</span> <span class="n">ValueAlias</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>

        <span class="n">value_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value_item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value registered for: </span><span class="si">{</span><span class="n">value_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">value_obj</span><span class="o">.</span><span class="n">is_set</span> <span class="ow">and</span> <span class="n">value_obj</span><span class="o">.</span><span class="n">value_schema</span><span class="o">.</span><span class="n">default</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NO_VALUE</span><span class="p">,</span>
            <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NOT_SET</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">value_obj</span><span class="o">.</span><span class="n">value_schema</span><span class="o">.</span><span class="n">default</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">value_obj</span><span class="o">.</span><span class="n">is_set</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value not set: </span><span class="si">{</span><span class="n">value_obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value_data_for_id</span><span class="p">(</span><span class="n">value_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NO_VALUE</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">get_value_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">get_lineage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value_item</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueLineage</span><span class="p">]:</span>

        <span class="n">value_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value_item</span><span class="o">=</span><span class="n">value_item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value registered for: </span><span class="si">{</span><span class="n">value_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value_lineage</span><span class="p">(</span><span class="n">value_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="c1"># def get_value_info(self, value_item: typing.Union[str, Value, ValueAlias]) -&gt; ValueInfo:</span>
    <span class="c1">#</span>
    <span class="c1">#     value_obj = self.get_value_obj(value_item=value_item)</span>
    <span class="c1">#</span>
    <span class="c1">#     aliases = self.find_aliases_for_value_id(value_id=value_obj.id, include_all_versions=True, include_tags=True)</span>
    <span class="c1">#</span>
    <span class="c1">#     info = ValueInfo(value_id=value_obj.id, value_type=value_obj.value_schema.type, aliases=aliases, metadata=value_obj.get_metadata())</span>
    <span class="c1">#     return info</span>

    <span class="k">def</span> <span class="nf">get_value_slot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueSlot</span><span class="p">]:</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">):</span>
            <span class="n">alias</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">alias</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value_slot_for_alias</span><span class="p">(</span><span class="n">alias_name</span><span class="o">=</span><span class="n">alias</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------------------------------</span>
    <span class="c1"># def _resolve_hash_to_value(</span>
    <span class="c1">#     self, hash_str: str, hash_type: typing.Optional[str] = None</span>
    <span class="c1"># ) -&gt; typing.Optional[Value]:</span>
    <span class="c1">#</span>
    <span class="c1">#     matches: typing.Set[str] = set()</span>
    <span class="c1">#     if hash_type is None:</span>
    <span class="c1">#         for hash_type, details in self._hashes.items():</span>
    <span class="c1">#             if hash_str in details.keys():</span>
    <span class="c1">#                 matches.add(details[hash_str])</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         hashes_for_type = self._hashes.get(hash_type, {})</span>
    <span class="c1">#         if hash_str in hashes_for_type.keys():</span>
    <span class="c1">#             matches.add(hashes_for_type[hash_str])</span>
    <span class="c1">#</span>
    <span class="c1">#     if len(matches) == 0:</span>
    <span class="c1">#         return None</span>
    <span class="c1">#     elif len(matches) &gt; 1:</span>
    <span class="c1">#         raise Exception(f&quot;Multiple values found for hash &#39;{hash_str}&#39;.&quot;)</span>
    <span class="c1">#</span>
    <span class="c1">#     match_id = next(iter(matches))</span>
    <span class="c1">#     value = self.get_value_obj(match_id)</span>
    <span class="c1">#     return value</span>

    <span class="k">def</span> <span class="nf">_check_register_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_token</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">register_token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_tokens</span>

    <span class="c1"># alias-related methods</span>
    <span class="k">def</span> <span class="nf">_resolve_alias_to_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="n">ValueAlias</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Value</span><span class="p">]:</span>

        <span class="n">alias_name</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">alias</span>
        <span class="n">alias_version</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">version</span>
        <span class="n">alias_tag</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">tag</span>

        <span class="n">value_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value_slot</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No alias &#39;</span><span class="si">{</span><span class="n">alias_name</span><span class="si">}</span><span class="s2">&#39; registered with registry.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">alias_tag</span><span class="p">:</span>
            <span class="n">_version</span> <span class="o">=</span> <span class="n">value_slot</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alias_tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">alias_version</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_version</span> <span class="o">!=</span> <span class="n">alias_version</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Value alias object contains both tag and version information, but actual version of tag resolves to different version in the registry: </span><span class="si">{</span><span class="n">_version</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">alias_version</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">alias_version</span> <span class="o">=</span> <span class="n">_version</span>

        <span class="k">assert</span> <span class="n">alias_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value_slot</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alias_version</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_find_aliases_for_value_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">ValueAlias</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Find all aliases that point to the specified value id.</span>

<span class="sd">        Sub-classes may overwrite this method for performance reasons.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_available_aliases</span><span class="p">():</span>
            <span class="n">value_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">value_slot</span>
            <span class="n">aliases</span> <span class="o">=</span> <span class="n">value_slot</span><span class="o">.</span><span class="n">find_linked_aliases</span><span class="p">(</span><span class="n">value_id</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_get_tags_for_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>

        <span class="n">value_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value_slot</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No alias &#39;</span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; registered with registry.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value_slot</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">find_aliases_for_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_item</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Value</span><span class="p">],</span>
        <span class="n">include_all_versions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">include_tags</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">ValueAlias</span><span class="p">]:</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value_item</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t find registered value for: </span><span class="si">{</span><span class="n">value_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_aliases_for_value_id</span><span class="p">(</span><span class="n">value_id</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">latest_cache</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">aliases</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">alias</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">include_all_versions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">alias</span><span class="o">.</span><span class="n">alias</span> <span class="ow">in</span> <span class="n">latest_cache</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">latest_version</span> <span class="o">=</span> <span class="n">latest_cache</span><span class="p">[</span><span class="n">alias</span><span class="o">.</span><span class="n">alias</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">latest_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_version_for_alias</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">alias</span><span class="p">)</span>
                        <span class="n">latest_cache</span><span class="p">[</span><span class="n">alias</span><span class="o">.</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">latest_version</span>
                    <span class="k">if</span> <span class="n">latest_version</span> <span class="o">==</span> <span class="n">alias</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">alias</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">include_tags</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">get_latest_version_for_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>

        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_versions_for_alias</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">versions</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_versions_for_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return all available versions for the specified alias.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">_alias</span> <span class="o">=</span> <span class="n">ValueAlias</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">ValueAlias</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid type for alias: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_alias</span> <span class="o">=</span> <span class="n">alias</span>

        <span class="n">value_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value_slot</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No alias &#39;</span><span class="si">{</span><span class="n">_alias</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; registered with registry.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">value_slot</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_tags_for_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">_alias</span> <span class="o">=</span> <span class="n">ValueAlias</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">ValueAlias</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid type for alias: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_alias</span> <span class="o">=</span> <span class="n">alias</span>

        <span class="n">value_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value_slot</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No alias &#39;</span><span class="si">{</span><span class="n">_alias</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; registered with registry.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">value_slot</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="nd">@deprecated</span><span class="p">(</span>
        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;This will be removed soon in favor of a more generic way to query values.&quot;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">find_all_values_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Value</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Find all values of a certain type.&quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">value_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ids</span><span class="p">:</span>
            <span class="n">value_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value_item</span><span class="o">=</span><span class="n">value_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value registered for: </span><span class="si">{</span><span class="n">value_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value_obj</span><span class="o">.</span><span class="n">type_name</span> <span class="o">==</span> <span class="n">value_type</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
                <span class="n">result</span><span class="p">[</span><span class="n">value_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_obj</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="c1"># TODO: compare all attributes if id is equal, just to make sure...</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DataRegistry</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  <div class="doc doc-object doc-method">



<h3 id="kiara.data.registry.__init__.BaseDataRegistry.find_all_values_of_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_all_values_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_type</span><span class="p">)</span></code>


<a href="#kiara.data.registry.__init__.BaseDataRegistry.find_all_values_of_type" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Find all values of a certain type.</p>

        <details class="quote">
          <summary>Source code in <code>kiara/data/registry/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@deprecated</span><span class="p">(</span>
    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;This will be removed soon in favor of a more generic way to query values.&quot;</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">find_all_values_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Value</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Find all values of a certain type.&quot;&quot;&quot;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">value_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ids</span><span class="p">:</span>
        <span class="n">value_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value_item</span><span class="o">=</span><span class="n">value_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value registered for: </span><span class="si">{</span><span class="n">value_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_obj</span><span class="o">.</span><span class="n">type_name</span> <span class="o">==</span> <span class="n">value_type</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="n">result</span><span class="p">[</span><span class="n">value_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_obj</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>









  <div class="doc doc-object doc-method">



<h3 id="kiara.data.registry.__init__.BaseDataRegistry.get_versions_for_alias" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_versions_for_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span></code>


<a href="#kiara.data.registry.__init__.BaseDataRegistry.get_versions_for_alias" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Return all available versions for the specified alias.</p>

        <details class="quote">
          <summary>Source code in <code>kiara/data/registry/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_versions_for_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Return all available versions for the specified alias.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">_alias</span> <span class="o">=</span> <span class="n">ValueAlias</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">ValueAlias</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid type for alias: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_alias</span> <span class="o">=</span> <span class="n">alias</span>

    <span class="n">value_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value_slot</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No alias &#39;</span><span class="si">{</span><span class="n">_alias</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; registered with registry.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">value_slot</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="kiara.data.registry.__init__.DataRegistry" class="doc doc-heading">
        <code>
DataRegistry            (<a title="kiara.data.registry.__init__.BaseDataRegistry" href="#kiara.data.registry.__init__.BaseDataRegistry">BaseDataRegistry</a>)
        </code>



<a href="#kiara.data.registry.__init__.DataRegistry" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>kiara/data/registry/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">DataRegistry</span><span class="p">(</span><span class="n">BaseDataRegistry</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kiara</span><span class="p">:</span> <span class="s2">&quot;Kiara&quot;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueLineage</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">kiara</span><span class="o">=</span><span class="n">kiara</span><span class="p">)</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_register_value_and_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Value</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Register data into this registry.</span>

<span class="sd">        Returns the values id. In case the value already has a value set (meaning it&#39;s different from string [NO_ID_YET_MARKER][kiara.data.value.NO_ID_YET_MARKER] / &#39;__no_id_yet__&#39;</span>
<span class="sd">        this method must use this id or throw an exception. Otherwise, it is required that the result id is different</span>
<span class="sd">        from ``NO_ID_YET_MARKER`` and a non-empty string.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_register_remote_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Value</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Register an existing value from a different registry into this one.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            value: the original value (with the &#39;_registry&#39; attribute still pointing to the original registry)</span>

<span class="sd">        Returns:</span>
<span class="sd">            either None (in which case the original value object will be copied with the &#39;_registry&#39; and &#39;_kiara&#39; attributes adjusted), or a value object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">register_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_data</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span> <span class="o">=</span> <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NOT_SET</span><span class="p">,</span>
        <span class="n">value_schema</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">ValueSchema</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataModel</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">lineage</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueLineage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Value</span><span class="p">:</span>

        <span class="c1"># if lineage and not lineage.output_name:</span>
        <span class="c1">#     raise Exception(f&quot;Value lineage for data of type &#39;{value_data.value_schema.type}&#39; does not have &#39;output_name&#39; field set.&quot;)</span>

        <span class="n">value_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">value_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ids</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Can&#39;t register value: value id &#39;</span><span class="si">{</span><span class="n">value_id</span><span class="si">}</span><span class="s2">&#39; already exists.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">value_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Can&#39;t register value: value id &#39;</span><span class="si">{</span><span class="n">value_id</span><span class="si">}</span><span class="s2">&#39; already exists as alias.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">value_schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_data</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
                <span class="n">value_schema</span> <span class="o">=</span> <span class="n">value_data</span><span class="o">.</span><span class="n">value_schema</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value schema provided for value: </span><span class="si">{</span><span class="n">value_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_schema</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">value_schema</span> <span class="o">=</span> <span class="n">ValueSchema</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">value_schema</span><span class="p">)</span>

        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kiara</span><span class="o">.</span><span class="n">get_value_type_cls</span><span class="p">(</span><span class="n">value_schema</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="n">_type_obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">value_schema</span><span class="o">.</span><span class="n">type_config</span><span class="p">)</span>

        <span class="n">existing_value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_data</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">value_data</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ids</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">metadata</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">lineage</span><span class="p">:</span>
                    <span class="n">existing_lineage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value_data</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">existing_lineage</span><span class="p">:</span>
                        <span class="n">log_message</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Overwriting existing value lineage for: </span><span class="si">{</span><span class="n">value_data</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="p">[</span><span class="n">value_data</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineage</span>

                <span class="c1"># TODO: check it&#39;s really the same</span>
                <span class="n">our_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value_data</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">our_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Could not retrieve cloned value, this is probably a bug.&quot;</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">our_value</span>

            <span class="n">existing_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_value_for_hashes</span><span class="p">(</span><span class="o">*</span><span class="n">value_data</span><span class="o">.</span><span class="n">get_hashes</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">existing_value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">metadata</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">lineage</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">existing_value</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overwriting value lineage for: </span><span class="si">{</span><span class="n">existing_value</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">lineage</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="p">[</span><span class="n">existing_value</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineage</span>

                <span class="k">return</span> <span class="n">existing_value</span>

            <span class="k">if</span> <span class="n">value_data</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ids</span> <span class="ow">and</span> <span class="n">metadata</span><span class="p">:</span>
                <span class="n">_metadata</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span>
                    <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span>
                <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="n">_metadata</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;metadata_item&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
                        <span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;metadata_schema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">schema_json</span><span class="p">()</span>

                <span class="c1"># TODO: not resolve value_data ?</span>
                <span class="n">cloned_new_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_value_obj</span><span class="p">(</span>
                    <span class="n">value_schema</span><span class="o">=</span><span class="n">value_data</span><span class="o">.</span><span class="n">value_schema</span><span class="p">,</span>
                    <span class="n">is_set</span><span class="o">=</span><span class="n">value_data</span><span class="o">.</span><span class="n">is_set</span><span class="p">,</span>
                    <span class="n">is_none</span><span class="o">=</span><span class="n">value_data</span><span class="o">.</span><span class="n">is_none</span><span class="p">,</span>
                    <span class="n">type_obj</span><span class="o">=</span><span class="n">value_data</span><span class="o">.</span><span class="n">type_obj</span><span class="p">,</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="n">_metadata</span><span class="p">,</span>
                    <span class="n">value_hashes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_new_value_obj</span><span class="p">(</span>
                    <span class="n">value_obj</span><span class="o">=</span><span class="n">cloned_new_metadata</span><span class="p">,</span>
                    <span class="n">value_data</span><span class="o">=</span><span class="n">value_data</span><span class="o">.</span><span class="n">get_value_data</span><span class="p">(),</span>
                    <span class="n">lineage</span><span class="o">=</span><span class="n">lineage</span><span class="p">,</span>
                    <span class="c1"># value_hashes=value_hashes,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">r</span>

            <span class="n">copied_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_remote_value</span><span class="p">(</span><span class="n">value_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">value_data</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ids</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Value with id &#39;</span><span class="si">{</span><span class="n">value_data</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; wasn&#39;t successfully registered. This is most likely a bug.&quot;</span>
                <span class="p">)</span>

            <span class="k">assert</span> <span class="n">copied_value</span><span class="o">.</span><span class="n">_registry</span> <span class="o">==</span> <span class="bp">self</span>
            <span class="k">assert</span> <span class="n">copied_value</span><span class="o">.</span><span class="n">_kiara</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kiara</span>

            <span class="k">if</span> <span class="n">value_data</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">copied_value</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="n">log_message</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Value id for value of type </span><span class="si">{</span><span class="n">copied_value</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2"> changed when registering in other registry.&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Imported value object with id &#39;</span><span class="si">{</span><span class="n">value_data</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; resulted in copied value with different id. This is a bug.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># for hash_type, value_hash in copied_value.get_hashes().items():</span>
            <span class="c1">#     self._hashes.setdefault(hash_type, {})[value_hash.hash] = value_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="p">[</span><span class="n">copied_value</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_data</span><span class="o">.</span><span class="n">get_lineage</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">copied_value</span>

        <span class="k">if</span> <span class="n">value_data</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NOT_SET</span><span class="p">,</span>
            <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NO_VALUE</span><span class="p">,</span>
        <span class="p">]</span> <span class="ow">and</span> <span class="n">value_schema</span><span class="o">.</span><span class="n">default</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NOT_SET</span><span class="p">,</span>
            <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NO_VALUE</span><span class="p">,</span>
        <span class="p">]:</span>

            <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
            <span class="n">value_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">value_schema</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value_data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NOT_SET</span><span class="p">,</span> <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NO_VALUE</span><span class="p">]:</span>
            <span class="c1"># TODO: actually implement that</span>
            <span class="k">for</span> <span class="n">hash_type</span> <span class="ow">in</span> <span class="n">_type_obj</span><span class="o">.</span><span class="n">get_supported_hash_types</span><span class="p">():</span>
                <span class="n">hash_str</span> <span class="o">=</span> <span class="n">_type_obj</span><span class="o">.</span><span class="n">calculate_value_hash</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">value_data</span><span class="p">,</span> <span class="n">hash_type</span><span class="o">=</span><span class="n">hash_type</span>
                <span class="p">)</span>
                <span class="n">existing_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_value_for_hashes</span><span class="p">(</span>
                    <span class="n">ValueHash</span><span class="p">(</span><span class="n">hash_type</span><span class="o">=</span><span class="n">hash_type</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="n">hash_str</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">existing_value</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">existing_value</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lineage</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">existing_value</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overwriting lineage for value &#39;</span><span class="si">{</span><span class="n">existing_value</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lineage</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="p">[</span><span class="n">existing_value</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineage</span>
            <span class="k">return</span> <span class="n">existing_value</span>

        <span class="k">if</span> <span class="n">value_schema</span><span class="o">.</span><span class="n">is_constant</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">value_data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NOT_SET</span><span class="p">,</span> <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NO_VALUE</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">value_data</span> <span class="o">!=</span> <span class="n">value_schema</span><span class="o">.</span><span class="n">default</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
            <span class="n">value_data</span> <span class="o">=</span> <span class="n">value_schema</span><span class="o">.</span><span class="n">default</span>

        <span class="n">is_set</span> <span class="o">=</span> <span class="n">value_data</span> <span class="o">!=</span> <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NOT_SET</span>
        <span class="n">is_none</span> <span class="o">=</span> <span class="n">value_data</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NO_VALUE</span><span class="p">,</span> <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NOT_SET</span><span class="p">]</span>

        <span class="n">_metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">_metadata</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;metadata_item&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
                <span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;metadata_schema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">schema_json</span><span class="p">()</span>

        <span class="c1"># value_hashes: typing.Dict[str] = {}</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_value_obj</span><span class="p">(</span>
            <span class="n">value_schema</span><span class="o">=</span><span class="n">value_schema</span><span class="p">,</span>
            <span class="n">is_set</span><span class="o">=</span><span class="n">is_set</span><span class="p">,</span>
            <span class="n">is_none</span><span class="o">=</span><span class="n">is_none</span><span class="p">,</span>
            <span class="n">type_obj</span><span class="o">=</span><span class="n">_type_obj</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">_metadata</span><span class="p">,</span>
            <span class="n">value_hashes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_register_new_value_obj</span><span class="p">(</span>
            <span class="n">value_obj</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
            <span class="n">value_data</span><span class="o">=</span><span class="n">value_data</span><span class="p">,</span>
            <span class="n">lineage</span><span class="o">=</span><span class="n">lineage</span><span class="p">,</span>
            <span class="c1"># value_hashes=value_hashes,</span>
        <span class="p">)</span>

        <span class="c1"># if not value.is_none:</span>
        <span class="c1"># value.get_metadata()</span>
        <span class="c1">#     metadata = self._kiara.metadata_mgmt.get_value_metadata(value=value, also_return_schema=True)</span>
        <span class="c1">#     print(metadata)</span>

        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_get_value_lineage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueLineage</span><span class="p">]:</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_value_obj</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_schema</span><span class="p">:</span> <span class="n">ValueSchema</span><span class="p">,</span>
        <span class="n">is_set</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">is_none</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">type_obj</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value_hashes</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">ValueHash</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="c1"># if value_schema.is_constant and value_data not in [</span>
        <span class="c1">#     SpecialValue.NO_VALUE,</span>
        <span class="c1">#     SpecialValue.NOT_SET,</span>
        <span class="c1">#     None,</span>
        <span class="c1"># ]:</span>
        <span class="c1">#     raise Exception(</span>
        <span class="c1">#         &quot;Can&#39;t create value. Is a constant, but value data was provided.&quot;</span>
        <span class="c1">#     )</span>

        <span class="k">if</span> <span class="n">type_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value_schema</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kiara</span><span class="o">.</span><span class="n">value_types</span><span class="p">:</span>
                <span class="n">log_message</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Value type &#39;</span><span class="si">{</span><span class="n">value_schema</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&#39; not supported in this kiara environment, changing type to &#39;any&#39;.&quot;</span>
                <span class="p">)</span>
                <span class="n">type_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kiara</span><span class="o">.</span><span class="n">get_value_type_cls</span><span class="p">(</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">type_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kiara</span><span class="o">.</span><span class="n">get_value_type_cls</span><span class="p">(</span><span class="n">value_schema</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">type_obj</span> <span class="o">=</span> <span class="n">type_cls</span><span class="p">(</span><span class="o">**</span><span class="n">value_schema</span><span class="o">.</span><span class="n">type_config</span><span class="p">)</span>

        <span class="n">register_token</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_register_tokens</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">register_token</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">Value</span><span class="p">(</span>
                <span class="n">registry</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="n">value_schema</span><span class="o">=</span><span class="n">value_schema</span><span class="p">,</span>
                <span class="n">type_obj</span><span class="o">=</span><span class="n">type_obj</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="n">is_set</span><span class="o">=</span><span class="n">is_set</span><span class="p">,</span>
                <span class="n">is_none</span><span class="o">=</span><span class="n">is_none</span><span class="p">,</span>
                <span class="n">hashes</span><span class="o">=</span><span class="n">value_hashes</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">register_token</span><span class="o">=</span><span class="n">register_token</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_register_tokens</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">register_token</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_register_new_value_obj</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_obj</span><span class="p">:</span> <span class="n">Value</span><span class="p">,</span>
        <span class="n">value_data</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
        <span class="n">lineage</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueLineage</span><span class="p">],</span>
        <span class="c1"># value_hashes: typing.Optional[typing.Mapping[str, ValueHash]] = None,</span>
    <span class="p">):</span>

        <span class="c1"># assert value_obj.id == NO_ID_YET_MARKER</span>

        <span class="k">if</span> <span class="n">value_data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NO_VALUE</span><span class="p">,</span>
            <span class="n">SpecialValue</span><span class="o">.</span><span class="n">NOT_SET</span><span class="p">,</span>
            <span class="n">SpecialValue</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="c1"># TODO: should we keep the original value?</span>
            <span class="n">value_data</span> <span class="o">=</span> <span class="n">value_obj</span><span class="o">.</span><span class="n">type_obj</span><span class="o">.</span><span class="n">import_value</span><span class="p">(</span><span class="n">value_data</span><span class="p">)</span>

        <span class="n">value_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_value_and_data</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value_obj</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">value_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value_obj</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">NO_ID_YET_MARKER</span><span class="p">:</span>
            <span class="n">value_obj</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">value_id</span>

        <span class="k">if</span> <span class="n">value_obj</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">value_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inconsistent id for value: </span><span class="si">{</span><span class="n">value_obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">value_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ids</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Value id &#39;</span><span class="si">{</span><span class="n">value_id</span><span class="si">}</span><span class="s2">&#39; wasn&#39;t registered propertly in registry. This is most likely a bug.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">lineage</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="p">[</span><span class="n">value_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineage</span>
        <span class="c1"># if value_hashes is None:</span>
        <span class="c1">#     value_hashes = {}</span>
        <span class="c1"># for hash_type, value_hash in value_hashes.items():</span>
        <span class="c1">#     self._hashes.setdefault(hash_type, {})[value_hash.hash] = value_id</span>

        <span class="k">return</span> <span class="n">value_obj</span>

    <span class="k">def</span> <span class="nf">set_value_lineage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value_item</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Value</span><span class="p">],</span> <span class="n">value_lineage</span><span class="p">:</span> <span class="n">ValueLineage</span>
    <span class="p">):</span>

        <span class="n">value_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value_item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value available for: </span><span class="si">{</span><span class="n">value_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lineages</span><span class="p">[</span><span class="n">value_obj</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_lineage</span>

    <span class="k">def</span> <span class="nf">link_alias</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Value</span><span class="p">],</span>
        <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">register_missing_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">value_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value for: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">value_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="n">alias</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_slot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">register_missing_alias</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Can&#39;t link value to alias &#39;</span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39;: alias not registered.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">register_alias</span><span class="p">(</span><span class="n">value_or_schema</span><span class="o">=</span><span class="n">value_obj</span><span class="p">,</span> <span class="n">alias_name</span><span class="o">=</span><span class="n">alias</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_alias</span> <span class="o">=</span> <span class="n">ValueAlias</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value_alias</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                <span class="n">value_slot</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span><span class="n">value_obj</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="n">value_alias</span><span class="o">.</span><span class="n">tag</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_slot</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span><span class="n">value_obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">link_aliases</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Value</span><span class="p">],</span>
        <span class="o">*</span><span class="n">aliases</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">register_missing_aliases</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">value_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value for: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">register_missing_aliases</span><span class="p">:</span>
            <span class="n">invalid</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">aliases</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">alias</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias_names</span><span class="p">:</span>
                    <span class="n">invalid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Can&#39;t link value(s), invalid alias(es): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">aliases</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">link_alias</span><span class="p">(</span><span class="n">value_obj</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="n">alias</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_valid_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="n">match</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">VALID_ALIAS_PATTERN</span><span class="p">,</span> <span class="n">alias_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_register_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value_schema</span><span class="p">:</span> <span class="n">ValueSchema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueSlot</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">register_aliases</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_or_schema</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">Value</span><span class="p">,</span> <span class="n">ValueSchema</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">aliases</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">callbacks</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">ValueSlotUpdateHandler</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">]:</span>

        <span class="n">invalid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">aliases</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_valid_alias</span><span class="p">(</span><span class="n">alias_name</span><span class="o">=</span><span class="n">alias</span><span class="p">):</span>
                <span class="n">invalid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid alias(es), only alphanumeric characters, &#39;-&#39;, and &#39;_&#39; allowed in alias name: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">aliases</span><span class="p">:</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_alias</span><span class="p">(</span>
                <span class="n">value_or_schema</span><span class="o">=</span><span class="n">value_or_schema</span><span class="p">,</span> <span class="n">alias_name</span><span class="o">=</span><span class="n">alias</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span>
            <span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">vs</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">register_alias</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_or_schema</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">Value</span><span class="p">,</span> <span class="n">ValueSchema</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="c1"># preseed: bool = False,</span>
        <span class="n">alias_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">ValueSlotUpdateHandler</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueSlot</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Register a value slot.</span>

<span class="sd">        A value slot is an object that holds multiple versions of values that all use the same schema.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            value_or_schema: a value, value_id, or schema, if value, it is added to the newly created slot (after preseed, if selected)</span>
<span class="sd">            preseed: whether to add an empty/non-set value to the newly created slot</span>
<span class="sd">            alias_name: the alias name, will be auto-created if not provided</span>
<span class="sd">            callbacks: a list of callbacks to trigger whenever the alias is updated</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">alias_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alias_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">alias_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty alias name not allowed.&quot;</span><span class="p">)</span>

        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_valid_alias</span><span class="p">(</span><span class="n">alias_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid alias &#39;</span><span class="si">{</span><span class="n">alias_name</span><span class="si">}</span><span class="s2">&#39;: only alphanumeric characters, &#39;-&#39;, and &#39;_&#39; allowed in alias name.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># if the provided value_or_schema argument is a string, it must be a value_id (for now)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_or_schema</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value_or_schema</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ids</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Can&#39;t register alias &#39;</span><span class="si">{</span><span class="n">alias_name</span><span class="si">}</span><span class="s2">&#39;, provided string &#39;</span><span class="si">{</span><span class="n">value_or_schema</span><span class="si">}</span><span class="s2">&#39; not an existing value id.&quot;</span>
                <span class="p">)</span>
            <span class="n">_value_or_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value_or_schema</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_value_or_schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value registered for: </span><span class="si">{</span><span class="n">value_or_schema</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">value_or_schema</span> <span class="o">=</span> <span class="n">_value_or_schema</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_or_schema</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
            <span class="n">_value_schema</span> <span class="o">=</span> <span class="n">value_or_schema</span><span class="o">.</span><span class="n">value_schema</span>
            <span class="n">_value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Value</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_or_schema</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_or_schema</span><span class="p">,</span> <span class="n">ValueSchema</span><span class="p">):</span>
            <span class="n">_value_schema</span> <span class="o">=</span> <span class="n">value_or_schema</span>
            <span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid value type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value_or_schema</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">alias_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_available_aliases</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Can&#39;t register alias: alias &#39;</span><span class="si">{</span><span class="n">alias_name</span><span class="si">}</span><span class="s2">&#39; already exists.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">alias_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_available_value_ids</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Can&#39;t register alias: alias &#39;</span><span class="si">{</span><span class="n">alias_name</span><span class="si">}</span><span class="s2">&#39; already exists as value id.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># vs = ValueSlot.from_value(id=_id, value=value_or_schema)</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_alias</span><span class="p">(</span><span class="n">alias_name</span><span class="o">=</span><span class="n">alias_name</span><span class="p">,</span> <span class="n">value_schema</span><span class="o">=</span><span class="n">_value_schema</span><span class="p">)</span>
        <span class="c1"># self._value_slots[vs.id] = vs</span>

        <span class="c1"># if preseed:</span>
        <span class="c1">#     _v = Value(value_schema=_value_schema, kiara=self._kiara, registry=self)</span>
        <span class="c1">#     vs.add_value(_v)</span>

        <span class="k">if</span> <span class="n">callbacks</span><span class="p">:</span>
            <span class="n">vs</span><span class="o">.</span><span class="n">register_callbacks</span><span class="p">(</span><span class="o">*</span><span class="n">callbacks</span><span class="p">)</span>
            <span class="c1"># self.register_callbacks(vs, *callbacks)</span>

        <span class="k">if</span> <span class="n">_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vs</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span><span class="n">_value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vs</span>

    <span class="c1"># def find_value_slots(</span>
    <span class="c1">#     self, value_item: typing.Union[str, Value]</span>
    <span class="c1"># ) -&gt; typing.List[ValueSlot]:</span>
    <span class="c1">#</span>
    <span class="c1">#     value_item = self.get_value_obj(value_item)</span>
    <span class="c1">#     result = []</span>
    <span class="c1">#     for slot_id, slot in self._value_slots.items():</span>
    <span class="c1">#         if slot.is_latest_value(value_item):</span>
    <span class="c1">#             result.append(slot)</span>
    <span class="c1">#     return result</span>

    <span class="c1"># def register_callbacks(</span>
    <span class="c1">#     self,</span>
    <span class="c1">#     alias: typing.Union[str, ValueSlot],</span>
    <span class="c1">#     *callbacks: ValueSlotUpdateHandler,</span>
    <span class="c1"># ) -&gt; None:</span>
    <span class="c1">#</span>
    <span class="c1">#     _value_slot = self.get_value_slot(alias)</span>
    <span class="c1">#     _value_slot.register_callbacks(*callbacks)</span>

    <span class="k">def</span> <span class="nf">update_value_slot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_slot</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">],</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
        <span class="n">value_lineage</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueLineage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="c1"># first, resolve a potential string into a value_slot or value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_slot</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value_slot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias_names</span><span class="p">:</span>
                <span class="n">_value_slot</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
                    <span class="kc">None</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">,</span> <span class="nb">str</span>
                <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="n">value_slot</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">value_slot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ids</span><span class="p">:</span>
                <span class="n">_value_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value_slot</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_value_slot</span> <span class="o">=</span> <span class="n">value_slot</span>

            <span class="k">if</span> <span class="n">_value_slot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t retrieve target object for id: </span><span class="si">{</span><span class="n">value_slot</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">value_slot</span> <span class="o">=</span> <span class="n">_value_slot</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_slot</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
            <span class="n">aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_aliases_for_value</span><span class="p">(</span><span class="n">value_slot</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="c1"># slots = self.find_value_slots(value_slot)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value slot found for value &#39;</span><span class="si">{</span><span class="n">value_slot</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Multiple value slots found for value &#39;</span><span class="si">{</span><span class="n">value_slot</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39;. This is not supported (yet).&quot;</span>
                <span class="p">)</span>
            <span class="n">_value_slot_2</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueSlot</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span>
                <span class="n">alias</span><span class="o">=</span><span class="n">aliases</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_slot</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">):</span>
            <span class="n">_value_slot_2</span> <span class="o">=</span> <span class="n">value_slot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid type for value slot: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value_slot</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">_value_slot_2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value_lineage</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can&#39;t update value slot with new value lineage data.&quot;</span><span class="p">)</span>
            <span class="n">_value</span><span class="p">:</span> <span class="n">Value</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_data</span><span class="p">(</span>
                <span class="n">value_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                <span class="n">value_schema</span><span class="o">=</span><span class="n">value_slot</span><span class="o">.</span><span class="n">value_schema</span><span class="p">,</span>
                <span class="n">lineage</span><span class="o">=</span><span class="n">value_lineage</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># _value = self.create_value(</span>
            <span class="c1">#     value_data=data,</span>
            <span class="c1">#     value_schema=_value_slot.value_schema,</span>
            <span class="c1">#     value_lineage=value_lineage,</span>
            <span class="c1"># )</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_value_slot</span><span class="p">(</span>
            <span class="n">value_slot</span><span class="o">=</span><span class="n">_value_slot_2</span><span class="p">,</span> <span class="n">new_value</span><span class="o">=</span><span class="n">_value</span><span class="p">,</span> <span class="n">trigger_callbacks</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_value_slots</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">updated_values</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataModel</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">lineage</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueLineage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="n">ValueSlot</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">]]:</span>

        <span class="n">updated</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">ValueSlot</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cb_map</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ValueSlotUpdateHandler</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">result</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">ValueSlot</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">invalid</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">value_item</span> <span class="ow">in</span> <span class="n">updated_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">):</span>
                <span class="n">alias</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">id</span>

            <span class="n">_alias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_alias</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">):</span>
                    <span class="n">invalid</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">invalid</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Can&#39;t update value slots: invalid alias name(s) &#39;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">value_item</span> <span class="ow">in</span> <span class="n">updated_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">):</span>
                <span class="n">alias</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">id</span>

            <span class="n">value_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value_slot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t retrieve value slot for alias: </span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">value_item</span> <span class="ow">in</span> <span class="n">updated_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">ValueSlot</span><span class="p">):</span>
                <span class="n">alias</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">id</span>

            <span class="n">value_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_slot</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value_slot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value slot for alias: </span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_item</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
                    <span class="n">_value_item</span><span class="p">:</span> <span class="n">Value</span> <span class="o">=</span> <span class="n">value_item</span>
                    <span class="k">if</span> <span class="n">_value_item</span><span class="o">.</span><span class="n">_registry</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
                        <span class="n">_value_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_data</span><span class="p">(</span>
                            <span class="n">_value_item</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">lineage</span><span class="o">=</span><span class="n">lineage</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">metadata</span><span class="p">:</span>
                        <span class="n">_value_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_data</span><span class="p">(</span>
                            <span class="n">_value_item</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">lineage</span><span class="o">=</span><span class="n">lineage</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_value_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_data</span><span class="p">(</span>
                        <span class="n">value_data</span><span class="o">=</span><span class="n">value_item</span><span class="p">,</span>
                        <span class="n">value_schema</span><span class="o">=</span><span class="n">value_slot</span><span class="o">.</span><span class="n">value_schema</span><span class="p">,</span>
                        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                        <span class="n">lineage</span><span class="o">=</span><span class="n">lineage</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">updated_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_value_slot</span><span class="p">(</span>
                    <span class="n">value_slot</span><span class="o">=</span><span class="n">value_slot</span><span class="p">,</span>
                    <span class="n">new_value</span><span class="o">=</span><span class="n">_value_item</span><span class="p">,</span>
                    <span class="n">trigger_callbacks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">value_slot</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_item</span>
                <span class="k">if</span> <span class="n">updated_item</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">cb_id</span><span class="p">,</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">value_slot</span><span class="o">.</span><span class="n">_callbacks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">cb_map</span><span class="p">[</span><span class="n">cb_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
                        <span class="n">updated</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">cb_id</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value_slot</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log_message</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">is_debug</span><span class="p">():</span>
                    <span class="kn">import</span> <span class="nn">traceback</span>

                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                <span class="n">result</span><span class="p">[</span><span class="n">value_slot</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>

        <span class="k">for</span> <span class="n">cb_id</span><span class="p">,</span> <span class="n">value_slots</span> <span class="ow">in</span> <span class="n">updated</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="n">cb_map</span><span class="p">[</span><span class="n">cb_id</span><span class="p">]</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">values_updated</span><span class="p">(</span><span class="o">*</span><span class="n">value_slots</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_update_value_slot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value_slot</span><span class="p">:</span> <span class="n">ValueSlot</span><span class="p">,</span> <span class="n">new_value</span><span class="p">:</span> <span class="n">Value</span><span class="p">,</span> <span class="n">trigger_callbacks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="n">last_version</span> <span class="o">=</span> <span class="n">value_slot</span><span class="o">.</span><span class="n">latest_version_nr</span>
        <span class="n">new_version</span> <span class="o">=</span> <span class="n">value_slot</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span>
            <span class="n">new_value</span><span class="p">,</span> <span class="n">trigger_callbacks</span><span class="o">=</span><span class="n">trigger_callbacks</span>
        <span class="p">)</span>

        <span class="n">updated</span> <span class="o">=</span> <span class="n">last_version</span> <span class="o">!=</span> <span class="n">new_version</span>
        <span class="k">return</span> <span class="n">updated</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  <div class="doc doc-object doc-method">



<h3 id="kiara.data.registry.__init__.DataRegistry.register_alias" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_or_schema</span><span class="p">,</span> <span class="n">alias_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#kiara.data.registry.__init__.DataRegistry.register_alias" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Register a value slot.</p>
<p>A value slot is an object that holds multiple versions of values that all use the same schema.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>value_or_schema</code></td>
        <td><code>Union[kiara.data.values.Value, kiara.data.values.ValueSchema, str]</code></td>
        <td><p>a value, value_id, or schema, if value, it is added to the newly created slot (after preseed, if selected)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>preseed</code></td>
        <td></td>
        <td><p>whether to add an empty/non-set value to the newly created slot</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>alias_name</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>the alias name, will be auto-created if not provided</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>callbacks</code></td>
        <td><code>Optional[Iterable[kiara.data.registry.__init__.ValueSlotUpdateHandler]]</code></td>
        <td><p>a list of callbacks to trigger whenever the alias is updated</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>kiara/data/registry/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register_alias</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">value_or_schema</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">Value</span><span class="p">,</span> <span class="n">ValueSchema</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="c1"># preseed: bool = False,</span>
    <span class="n">alias_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">ValueSlotUpdateHandler</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueSlot</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Register a value slot.</span>

<span class="sd">    A value slot is an object that holds multiple versions of values that all use the same schema.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        value_or_schema: a value, value_id, or schema, if value, it is added to the newly created slot (after preseed, if selected)</span>
<span class="sd">        preseed: whether to add an empty/non-set value to the newly created slot</span>
<span class="sd">        alias_name: the alias name, will be auto-created if not provided</span>
<span class="sd">        callbacks: a list of callbacks to trigger whenever the alias is updated</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">alias_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">alias_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">alias_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty alias name not allowed.&quot;</span><span class="p">)</span>

    <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_valid_alias</span><span class="p">(</span><span class="n">alias_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid alias &#39;</span><span class="si">{</span><span class="n">alias_name</span><span class="si">}</span><span class="s2">&#39;: only alphanumeric characters, &#39;-&#39;, and &#39;_&#39; allowed in alias name.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># if the provided value_or_schema argument is a string, it must be a value_id (for now)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_or_schema</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value_or_schema</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ids</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Can&#39;t register alias &#39;</span><span class="si">{</span><span class="n">alias_name</span><span class="si">}</span><span class="s2">&#39;, provided string &#39;</span><span class="si">{</span><span class="n">value_or_schema</span><span class="si">}</span><span class="s2">&#39; not an existing value id.&quot;</span>
            <span class="p">)</span>
        <span class="n">_value_or_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_obj</span><span class="p">(</span><span class="n">value_or_schema</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_value_or_schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value registered for: </span><span class="si">{</span><span class="n">value_or_schema</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">value_or_schema</span> <span class="o">=</span> <span class="n">_value_or_schema</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_or_schema</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
        <span class="n">_value_schema</span> <span class="o">=</span> <span class="n">value_or_schema</span><span class="o">.</span><span class="n">value_schema</span>
        <span class="n">_value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Value</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_or_schema</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_or_schema</span><span class="p">,</span> <span class="n">ValueSchema</span><span class="p">):</span>
        <span class="n">_value_schema</span> <span class="o">=</span> <span class="n">value_or_schema</span>
        <span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid value type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value_or_schema</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">alias_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_available_aliases</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Can&#39;t register alias: alias &#39;</span><span class="si">{</span><span class="n">alias_name</span><span class="si">}</span><span class="s2">&#39; already exists.&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">alias_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_available_value_ids</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Can&#39;t register alias: alias &#39;</span><span class="si">{</span><span class="n">alias_name</span><span class="si">}</span><span class="s2">&#39; already exists as value id.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># vs = ValueSlot.from_value(id=_id, value=value_or_schema)</span>
    <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_alias</span><span class="p">(</span><span class="n">alias_name</span><span class="o">=</span><span class="n">alias_name</span><span class="p">,</span> <span class="n">value_schema</span><span class="o">=</span><span class="n">_value_schema</span><span class="p">)</span>
    <span class="c1"># self._value_slots[vs.id] = vs</span>

    <span class="c1"># if preseed:</span>
    <span class="c1">#     _v = Value(value_schema=_value_schema, kiara=self._kiara, registry=self)</span>
    <span class="c1">#     vs.add_value(_v)</span>

    <span class="k">if</span> <span class="n">callbacks</span><span class="p">:</span>
        <span class="n">vs</span><span class="o">.</span><span class="n">register_callbacks</span><span class="p">(</span><span class="o">*</span><span class="n">callbacks</span><span class="p">)</span>
        <span class="c1"># self.register_callbacks(vs, *callbacks)</span>

    <span class="k">if</span> <span class="n">_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vs</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vs</span>
</code></pre></div>
        </details>
    </div>

  </div>










  </div>

    </div>

  </div>




  <div class="doc doc-object doc-class">



<h2 id="kiara.data.registry.__init__.ValueSlotUpdateHandler" class="doc doc-heading">
        <code>
ValueSlotUpdateHandler            (<span title="typing.Protocol">Protocol</span>)
        </code>



<a href="#kiara.data.registry.__init__.ValueSlotUpdateHandler" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>The call signature for callbacks that can be registered as value update handlers.</p>

        <details class="quote">
          <summary>Source code in <code>kiara/data/registry/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ValueSlotUpdateHandler</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The call signature for callbacks that can be registered as value update handlers.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">values_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="s2">&quot;ValueSlot&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  </div>

    </div>

  </div>







  </div>

    </div>

  </div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../kiara.data.onboarding.batch/" class="md-footer__link md-footer__link--prev" aria-label="Previous: ➜ data.onboarding.batch" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              ➜ data.onboarding.batch
            </div>
          </div>
        </a>
      
      
        
        <a href="../kiara.data.registry.store/" class="md-footer__link md-footer__link--next" aria-label="Next: ➜ data.registry.store" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              ➜ data.registry.store
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            DHARPA project
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>